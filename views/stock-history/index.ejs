<%- include('../partials/header') %>

    <!-- Page Header -->
    <div class="page-header">
        <div class="page-header-content">
            <h1>üìä Stock Movement History</h1>
            <p>Complete history of all inventory changes</p>
        </div>
        <div class="page-header-actions">
            <a href="/dashboard" class="btn btn-ghost">‚Üê Back to Dashboard</a>
        </div>
    </div>

    <!-- Stats Summary -->
    <div class="card mb-4">
        <div class="card-body" style="padding: 1rem 1.5rem;">
            <div style="display: flex; gap: 2rem; align-items: center;">
                <div>
                    <span class="text-muted">Total Movements:</span>
                    <strong>
                        <%= pagination.totalCount %>
                    </strong>
                </div>
                <div>
                    <span class="text-muted">Page:</span>
                    <strong>
                        <%= pagination.page %> of <%= pagination.totalPages %>
                    </strong>
                </div>
            </div>
        </div>
    </div>

    <!-- Movement History Table -->
    <div class="card">
        <div class="card-body" style="padding: 0;">
            <% if (movements && movements.length> 0) { %>
                <div class="table-responsive">
                    <table class="styled-table">
                        <thead>
                            <tr>
                                <th>Date & Time</th>
                                <th>Product</th>
                                <th>SKU</th>
                                <th>Change</th>
                                <th>Reason</th>
                                <th>Notes</th>
                                <th>By</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% movements.forEach(movement=> { %>
                                <tr>
                                    <td>
                                        <div style="white-space: nowrap;">
                                            <strong>
                                                <%= new Date(movement.created_at).toLocaleDateString('en-IN', {
                                                    day: '2-digit' , month: 'short' , year: 'numeric' }) %>
                                            </strong>
                                            <br>
                                            <span class="text-muted text-sm">
                                                <%= new Date(movement.created_at).toLocaleTimeString('en-IN', {
                                                    hour: '2-digit' , minute: '2-digit' }) %>
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <strong>
                                            <%= movement.product_name || 'Deleted Product' %>
                                        </strong>
                                    </td>
                                    <td>
                                        <span class="text-muted">
                                            <%= movement.product_sku || '-' %>
                                        </span>
                                    </td>
                                    <td>
                                        <% if (movement.quantity_change> 0) { %>
                                            <span class="badge badge-success">+<%= movement.quantity_change %></span>
                                            <% } else { %>
                                                <span class="badge badge-danger">
                                                    <%= movement.quantity_change %>
                                                </span>
                                                <% } %>
                                    </td>
                                    <td>
                                        <span class="category-tag">
                                            <%= movement.reason %>
                                        </span>
                                    </td>
                                    <td>
                                        <span class="text-muted text-sm">
                                            <%= movement.notes || '-' %>
                                        </span>
                                    </td>
                                    <td>
                                        <span class="text-muted text-sm">
                                            <%= movement.user_email ? movement.user_email.split('@')[0] : 'System' %>
                                        </span>
                                    </td>
                                </tr>
                                <% }) %>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <% if (pagination.totalPages> 1) { %>
                    <div class="pagination-container"
                        style="padding: 1rem; display: flex; justify-content: center; gap: 0.5rem;">
                        <% if (pagination.page> 1) { %>
                            <a href="/stock-history?page=<%= pagination.page - 1 %>" class="btn btn-ghost btn-sm">‚Üê
                                Previous</a>
                            <% } %>

                                <% for (let i=1; i <=pagination.totalPages; i++) { %>
                                    <% if (i===pagination.page) { %>
                                        <span class="btn btn-primary btn-sm">
                                            <%= i %>
                                        </span>
                                        <% } else if (i===1 || i===pagination.totalPages || (i>= pagination.page - 2 &&
                                            i <= pagination.page + 2)) { %>
                                                <a href="/stock-history?page=<%= i %>" class="btn btn-ghost btn-sm">
                                                    <%= i %>
                                                </a>
                                                <% } else if (i===pagination.page - 3 || i===pagination.page + 3) { %>
                                                    <span class="text-muted">...</span>
                                                    <% } %>
                                                        <% } %>

                                                            <% if (pagination.page < pagination.totalPages) { %>
                                                                <a href="/stock-history?page=<%= pagination.page + 1 %>"
                                                                    class="btn btn-ghost btn-sm">Next ‚Üí</a>
                                                                <% } %>
                    </div>
                    <% } %>

                        <% } else { %>
                            <div class="empty-state" style="padding: 3rem; text-align: center;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">üì¶</div>
                                <h3>No Stock Movements Yet</h3>
                                <p class="text-muted">Stock movements will appear here when you add, sell, or adjust
                                    product quantities.</p>
                                <a href="/products" class="btn btn-primary" style="margin-top: 1rem;">View Products</a>
                            </div>
                            <% } %>
        </div>
    </div>

    <%- include('../partials/footer') %>