<%- include('../partials/header') %>

<!-- Header Section -->
<div class="flex-between mb-6">
    <div>
        <h1>Add New Product</h1>
        <p class="text-muted">Create a new product in your inventory</p>
    </div>
    <a href="/products" class="btn btn-secondary">‚Üê Back to List</a>
</div>

<!-- Flash Messages -->
<% if (typeof error !== 'undefined' && error) { %>
    <div class="alert alert-danger mb-4">
        <span>‚úï</span>
        <%= error %>
        <button class="alert-close" onclick="this.parentElement.remove()">√ó</button>
    </div>
<% } %>

<!-- Form Card -->
<div class="card">
    <div class="card-header">
        <h3>üì¶ Product Details</h3>
    </div>
    <div class="card-body">
        <form action="/products" method="POST" enctype="multipart/form-data" class="product-form">
            
            <!-- 2-Column Grid -->
            <div class="grid-2">
                <!-- LEFT COLUMN -->
                <div class="form-column">
                    <div class="form-group">
                        <label class="form-label" for="name">
                            Product Name <span class="required">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="name" 
                            name="name" 
                            class="form-input" 
                            placeholder="e.g., Wireless Bluetooth Headphones"
                            required
                            autofocus
                        >
                        <div class="sku-info">
                            <span class="badge badge-info">‚ÑπÔ∏è SKU will be auto-generated by the system</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="category_id">Category</label>
                        <select id="category_id" name="category_id" class="form-select">
                            <option value="">-- Select Category --</option>
                            <% if (typeof categories !== 'undefined' && categories.length > 0) { %>
                                <% categories.forEach(category => { %>
                                    <option value="<%= category.id %>"><%= category.name %></option>
                                <% }) %>
                            <% } %>
                        </select>
                    </div>
                </div>

                <!-- RIGHT COLUMN -->
                <div class="form-column">
                    <div class="form-group">
                        <label class="form-label" for="cost_price">
                            Cost Price <span class="text-muted">(what you paid)</span>
                        </label>
                        <div class="input-group">
                            <span class="input-addon">$</span>
                            <input 
                                type="number" 
                                id="cost_price" 
                                name="cost_price" 
                                class="form-input" 
                                step="0.01" 
                                min="0" 
                                placeholder="0.00"
                            >
                        </div>
                        <span class="form-hint">Used for profit calculation & AI pricing</span>
                    </div>

                    <div class="form-group">
                        <div class="form-label-row">
                            <label class="form-label" for="price">
                                Selling Price <span class="required">*</span>
                            </label>
                            <button 
                                type="button" 
                                id="aiPriceBtn" 
                                class="btn btn-outline btn-sm ai-btn"
                            >
                                üí° Suggest Price
                            </button>
                        </div>
                        <div class="input-group">
                            <span class="input-addon">$</span>
                            <input 
                                type="number" 
                                id="price" 
                                name="price" 
                                class="form-input" 
                                step="0.01" 
                                min="0" 
                                placeholder="0.00"
                                required
                            >
                        </div>
                        <div id="priceAiStatus" class="ai-status hidden">
                            <span class="ai-spinner">‚è≥</span>
                            <span>Getting AI suggestion...</span>
                        </div>
                        <div id="priceSuggestion" class="price-suggestion hidden"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="stock_quantity">Stock Quantity</label>
                        <input 
                            type="number" 
                            id="stock_quantity" 
                            name="stock_quantity" 
                            class="form-input" 
                            min="0" 
                            value="0"
                            placeholder="0"
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="image">Product Image</label>
                        <input 
                            type="file" 
                            id="image" 
                            name="image" 
                            class="form-input-file"
                            accept="image/*"
                        >
                        <span class="form-hint">Accepted formats: JPG, PNG, WebP (max 5MB)</span>
                    </div>
                </div>
            </div>

            <!-- AI SECTION (Full Width) -->
            <div class="form-section">
                <div class="form-group">
                    <div class="form-label-row">
                        <label class="form-label" for="description">Description</label>
                        <button 
                            type="button" 
                            id="aiGenerateBtn" 
                            class="btn btn-outline btn-sm ai-btn"
                        >
                            ‚ú® Auto-Write with AI
                        </button>
                    </div>
                    <textarea 
                        id="description" 
                        name="description" 
                        class="form-textarea" 
                        rows="5"
                        placeholder="Describe your product... or let AI generate it for you!"
                    ></textarea>
                    <div id="aiStatus" class="ai-status hidden">
                        <span class="ai-spinner">‚è≥</span>
                        <span>Generating description...</span>
                    </div>
                </div>
            </div>

            <!-- Form Footer -->
            <div class="form-footer">
                <a href="/products" class="btn btn-secondary">Cancel</a>
                <button type="submit" class="btn btn-primary">
                    üíæ Save Product
                </button>
            </div>
        </form>
    </div>
</div>

<%- include('../partials/footer') %>
