<%- include('../partials/header') %>

<!-- Header Section -->
<div class="flex-between mb-6">
    <div>
        <h1>Edit Product</h1>
        <p class="text-muted">Update product information</p>
    </div>
    <a href="/products" class="btn btn-secondary">‚Üê Back to List</a>
</div>

<!-- Flash Messages -->
<% if (typeof error !== 'undefined' && error) { %>
    <div class="alert alert-danger mb-4">
        <span>‚úï</span>
        <%= error %>
        <button class="alert-close" onclick="this.parentElement.remove()">√ó</button>
    </div>
<% } %>

<!-- Form Card -->
<div class="card">
    <div class="card-header">
        <h3>üì¶ Product Details</h3>
        <span class="badge badge-secondary">SKU: <%= product.sku %></span>
    </div>
    <div class="card-body">
        <form action="/products/<%= product.id %>?_method=PUT" method="POST" enctype="multipart/form-data" class="product-form">
            
            <!-- 2-Column Grid -->
            <div class="grid-2">
                <!-- LEFT COLUMN -->
                <div class="form-column">
                    <div class="form-group">
                        <label class="form-label" for="name">
                            Product Name <span class="required">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="name" 
                            name="name" 
                            class="form-input" 
                            placeholder="e.g., Wireless Bluetooth Headphones"
                            value="<%= product.name %>"
                            required
                            autofocus
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="category_id">Category</label>
                        <select id="category_id" name="category_id" class="form-select">
                            <option value="">-- Select Category --</option>
                            <% if (typeof categories !== 'undefined' && categories.length > 0) { %>
                                <% categories.forEach(category => { %>
                                    <option 
                                        value="<%= category.id %>"
                                        <%= product.category_id == category.id ? 'selected' : '' %>
                                    ><%= category.name %></option>
                                <% }) %>
                            <% } %>
                        </select>
                    </div>
                </div>

                <!-- RIGHT COLUMN -->
                <div class="form-column">
                    <div class="form-group">
                        <label class="form-label" for="price">
                            Price <span class="required">*</span>
                        </label>
                        <div class="input-group">
                            <span class="input-addon">$</span>
                            <input 
                                type="number" 
                                id="price" 
                                name="price" 
                                class="form-input" 
                                step="0.01" 
                                min="0" 
                                placeholder="0.00"
                                value="<%= product.price %>"
                                required
                            >
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="stock_quantity">Stock Quantity</label>
                        <input 
                            type="number" 
                            id="stock_quantity" 
                            name="stock_quantity" 
                            class="form-input" 
                            min="0" 
                            value="<%= product.stock_quantity %>"
                            placeholder="0"
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="image">Product Image</label>
                        <% if (product.image_url) { %>
                            <div class="current-image mb-2">
                                <img src="<%= product.image_url %>" alt="<%= product.name %>" class="product-thumb">
                                <span class="text-muted text-sm">Current image</span>
                            </div>
                        <% } %>
                        <input 
                            type="file" 
                            id="image" 
                            name="image" 
                            class="form-input-file"
                            accept="image/*"
                        >
                        <span class="form-hint">Leave empty to keep current image. Accepted: JPG, PNG, WebP (max 5MB)</span>
                    </div>
                </div>
            </div>

            <!-- Description Section (Full Width) -->
            <div class="form-section">
                <div class="form-group">
                    <div class="form-label-row">
                        <label class="form-label" for="description">Description</label>
                        <button 
                            type="button" 
                            id="aiGenerateBtn" 
                            class="btn btn-outline btn-sm ai-btn"
                        >
                            ‚ú® Auto-Write with AI
                        </button>
                    </div>
                    <textarea 
                        id="description" 
                        name="description" 
                        class="form-textarea" 
                        rows="5"
                        placeholder="Describe your product... or let AI generate it for you!"
                    ><%= product.description || '' %></textarea>
                    <div id="aiStatus" class="ai-status hidden">
                        <span class="ai-spinner">‚è≥</span>
                        <span>Generating description...</span>
                    </div>
                </div>
            </div>

            <!-- Form Footer -->
            <div class="form-footer">
                <a href="/products" class="btn btn-secondary">Cancel</a>
                <button type="submit" class="btn btn-primary">
                    üíæ Update Product
                </button>
            </div>
        </form>
    </div>
</div>

<%- include('../partials/footer') %>
